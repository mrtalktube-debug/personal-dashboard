<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Michael Strategic Dashboard v5.0</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --p-blue: #0073b1; --bg: linear-gradient(135deg, #001a33 0%, #000a14 100%); }
        body { background: var(--bg); min-height: 100vh; font-family: 'Inter', sans-serif; color: #1a1a1a; margin: 0; }
        .widget { background: rgba(255,255,255,0.98); border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; overflow: hidden; height: 100%; }
        .tab-btn { font-size: 0.65rem; font-weight: 800; padding: 10px; color: #666; border-bottom: 2px solid transparent; text-transform: uppercase; flex: 1; text-align: center; cursor: pointer; }
        .tab-btn.active { color: var(--p-blue); border-bottom-color: var(--p-blue); background: rgba(0,115,177,0.05); }
        .sudoku-container { display: grid; grid-template-columns: repeat(9, 1fr); border: 2px solid #1a1a1a; background: white; width: 100%; max-width: 280px; margin: 0 auto; aspect-ratio: 1/1; }
        .sudoku-cell { border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; font-size: 1rem; font-weight: bold; aspect-ratio: 1/1; }
        .sudoku-cell.fixed { background: #f8fafc; color: #1e293b; font-weight: 900; }
        .border-r-thick { border-right: 2px solid #1a1a1a !important; }
        .border-b-thick { border-bottom: 2px solid #1a1a1a !important; }
        .settings-panel { position: fixed; right: 0; top: 0; height: 100vh; width: 100%; max-width: 480px; background: white; z-index: 100; transform: translateX(100%); transition: 0.3s ease; box-shadow: -10px 0 30px rgba(0,0,0,0.5); overflow-y: auto; padding-bottom: 5rem; }
        .settings-panel.open { transform: translateX(0); }
        .scroll-h { overflow-x: auto; display: flex; gap: 1rem; padding-bottom: 10px; }
        .scroll-v { overflow-y: auto; scrollbar-width: thin; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--p-blue); border-radius: 4px; }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef, useMemo } = React;

const ALLOWED_EMAIL = "diabaas3@gmail.com"; 
const S = {
    load: (k, d) => { try { const v = localStorage.getItem('v5_'+k); return v ? JSON.parse(v) : d; } catch(e) { return d; } },
    save: (k, v) => localStorage.setItem('v5_'+k, JSON.stringify(v)),
    remove: (k) => localStorage.removeItem('v5_'+k)
};

const Ico = {
    Set: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3" strokeWidth="2"/></svg>,
    Lock: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>,
    Peper: () => <span className="text-lg">üå∂Ô∏è</span>
};

// --- WEER BALK ---
function WeatherBar() {
    const [w, setW] = useState(null);
    useEffect(() => {
        fetch("https://api.open-meteo.com/v1/forecast?latitude=52.0675&longitude=4.4931&current=temperature_2m,apparent_temperature,precipitation&timezone=auto")
            .then(r => r.json()).then(data => setW({ t: Math.round(data.current.temperature_2m), f: Math.round(data.current.apparent_temperature) }))
            .catch(() => {});
    }, []);
    return (
        <div className="bg-white/10 px-6 py-2 border-b border-white/10 flex justify-between items-center text-white text-[10px] font-bold uppercase tracking-widest">
            <div className="flex gap-6"><span>Zoetermeer</span><span>{w?.t || '--'}¬∞C</span><span className="opacity-50">Gevoel: {w?.f || '--'}¬∞C</span></div>
            <div className="text-green-400 font-black animate-pulse">‚óè SYSTEM ONLINE</div>
        </div>
    );
}

// --- AGENDA WIDGET ---
function AgendaWidget({ lang }) {
    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
    const [search, setSearch] = useState("");
    const [events, setEvents] = useState([]);
    const icals = S.load('icals', []);

    useEffect(() => {
        const fetchEvents = async () => {
            let all = [];
            for (let c of icals) {
                if (!c.url) continue;
                try {
                    const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(c.url)}`);
                    const txt = await res.text();
                    const lines = txt.split(/\r?\n/);
                    let cur = {};
                    lines.forEach(l => {
                        if(l.startsWith('SUMMARY:')) cur.t = l.substring(8);
                        if(l.startsWith('DTSTART')) { 
                            const m = l.match(/:(\d{4})(\d{2})(\d{2})T?(\d{2})?(\d{2})?/);
                            if(m) { cur.d = `${m[1]}-${m[2]}-${m[3]}`; cur.time = m[4] ? `${m[4]}:${m[5]}` : '00:00'; }
                        }
                        if(l.startsWith('END:VEVENT')) { if(cur.t) all.push({...cur, p: c.name}); cur = {}; }
                    });
                } catch(e) {}
            }
            setEvents(all);
        };
        fetchEvents();
    }, [JSON.stringify(icals)]);

    const schoolTimes = useMemo(() => {
        const getRange = (name) => {
            const today = events.filter(e => e.d === date && e.p === name).sort((a,b) => a.time.localeCompare(b.time));
            return today.length > 0 ? `${today[0].time} - ${today[today.length-1].time}` : "Vrij";
        };
        return { ryan: getRange('Ryan'), yaron: getRange('Yaron') };
    }, [date, events]);

    const weekNum = useMemo(() => {
        const d = new Date(date); d.setHours(0,0,0,0); d.setDate(d.getDate()+4-(d.getDay()||7));
        return Math.ceil((((d-new Date(d.getFullYear(),0,1))/8.64e7)+1)/7);
    }, [date]);

    return (
        <div className="widget p-6 h-[580px]">
            <div className="flex justify-between items-center mb-4">
                <h3 className="text-[10px] font-black uppercase text-gray-400">Agenda</h3>
                <div className="flex gap-2">
                    <button onClick={() => setDate(new Date().toISOString().split('T')[0])} className="px-3 py-1 bg-blue-600 text-white text-[9px] rounded font-black">VANDAAG</button>
                    <input type="date" value={date} onChange={e => setDate(e.target.value)} className="px-2 py-1 border rounded text-[9px] font-bold outline-none" />
                </div>
            </div>
            <div className="flex-1 scroll-v mb-4">
                <p className="text-[11px] font-black text-blue-600 uppercase mb-4">
                    {new Date(date).toLocaleDateString('nl-NL', {weekday:'long', day:'numeric', month:'long'})} - Week {weekNum}
                </p>
                {events.filter(e => e.d === date).map((e, i) => (
                    <div key={i} className="p-3 bg-gray-50 rounded-xl border-l-4 border-blue-500 mb-2 flex justify-between">
                        <span className="text-xs font-bold">{e.t} <span className="text-[9px] text-gray-400 ml-2">({e.p})</span></span>
                        <span className="text-[10px] font-mono font-bold">{e.time}</span>
                    </div>
                ))}
            </div>
            <div className="pt-4 border-t space-y-4">
                <input type="text" placeholder="Zoek event of kalender..." value={search} onChange={e=>setSearch(e.target.value)} className="w-full p-3 border rounded-xl text-xs bg-gray-50 outline-none" />
                <div className="grid grid-cols-2 gap-4">
                    <div className="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                        <span className="text-[9px] font-black text-blue-400 block uppercase mb-1">Ryan</span>
                        <span className="text-xs font-bold text-blue-900">{schoolTimes.ryan}</span>
                    </div>
                    <div className="bg-green-50 p-4 rounded-2xl border border-green-100">
                        <span className="text-[9px] font-black text-green-400 block uppercase mb-1">Yaron</span>
                        <span className="text-xs font-bold text-green-900">{schoolTimes.yaron}</span>
                    </div>
                </div>
            </div>
        </div>
    );
}

// --- CRYPTO WIDGET ---
function CryptoWidget() {
    const coins = [
        {s:'BTC', h:0.8, d:2.5, w:-1.1, m:18.4, y:142.1, a:4500},
        {s:'ETH', h:-0.2, d:1.4, w:4.2, m:9.1, y:88.4, a:1200}
    ];
    const P = ({v}) => <span className={`font-mono font-bold ${v>=0?'text-green-500':'text-red-500'}`}>{v>0?'+':''}{v}%</span>;
    return (
        <div className="widget p-6 h-[400px]">
            <h3 className="text-[10px] font-black uppercase text-gray-400 mb-6">Market Trends</h3>
            <div className="scroll-v space-y-4">
                {coins.map(c => (
                    <div key={c.s} className="p-4 border rounded-2xl bg-gray-50">
                        <span className="font-black text-lg block mb-3">{c.s}</span>
                        <div className="grid grid-cols-3 gap-y-3 text-[9px] font-black uppercase">
                            <div>1U: <P v={c.h}/></div><div>1D: <P v={c.d}/></div><div>1W: <P v={c.w}/></div>
                            <div>1M: <P v={c.m}/></div><div>1J: <P v={c.y}/></div><div>ALL: <P v={c.a}/></div>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}

// --- PEPPER WIDGET ---
function PepperWidget() {
    return (
        <div className="widget p-6 h-[300px]">
            <div className="flex items-center gap-2 mb-4"><Ico.Peper/><h3 className="text-[10px] font-black uppercase text-gray-400">Pepper</h3></div>
            <div className="scroll-h scrollbar-hide">
                {[ {t:"iPhone 15 Pro", p:"‚Ç¨999", d:"-20%"}, {t:"Sony XM5", p:"‚Ç¨259", d:"-30%"}, {t:"MacBook Air", p:"‚Ç¨899", d:"-25%"}, {t:"Hue Bridge", p:"‚Ç¨45", d:"-50%"} ].map((d, i) => (
                    <div key={i} className="min-w-[160px] p-4 bg-gray-50 border rounded-2xl flex flex-col justify-between">
                        <span className="bg-red-500 text-white text-[8px] font-black px-2 py-0.5 rounded-full w-fit uppercase">HOT Deal</span>
                        <h4 className="text-[11px] font-bold mt-2 h-8 overflow-hidden">{d.t}</h4>
                        <span className="text-blue-600 font-black mt-3">{d.p} ({d.d})</span>
                    </div>
                ))}
            </div>
        </div>
    );
}

// --- RECEPTEN WIDGET ---
function RecipeWidget() {
    const [ppl, setPpl] = useState(1);
    const recs = [
        {n: "Pasta Pesto", prot: 28, i: ["120g Kip", "80g Pasta", "Pesto"]},
        {n: "Zalm Teriyaki", prot: 42, i: ["200g Zalm", "100g Rijst", "Groente"]},
        {n: "Eiwit Pannenkoek", prot: 35, i: ["2 Eieren", "50g Haver", "Prote√Øne poeder"]}
    ];
    return (
        <div className="widget p-6 h-[400px]">
            <div className="flex justify-between items-center mb-6">
                <h3 className="text-[10px] font-black uppercase text-gray-400">Recepten</h3>
                <select value={ppl} onChange={e=>setPpl(e.target.value)} className="text-xs font-bold border rounded p-1">
                    {[1,2,3,4,5].map(n=><option key={n} value={n}>{n} Pers.</option>)}
                </select>
            </div>
            <div className="scroll-v space-y-4">
                {recs.map((r, i) => (
                    <div key={i} className="p-4 border rounded-2xl">
                        <div className="flex justify-between mb-2"><h4 className="font-bold text-sm">{r.n}</h4><span className="text-[9px] bg-blue-100 text-blue-700 px-2 rounded-full font-black">{r.prot * ppl}g EIWIT</span></div>
                        <ul className="text-[10px] text-gray-500 italic">{r.i.map(ing => <li key={ing}>‚Ä¢ {ing.replace(/\d+/, m => m * ppl)}</li>)}</ul>
                    </div>
                ))}
            </div>
        </div>
    );
}

// --- SUDOKU WIDGET ---
function SudokuWidget() {
    const grid = [5,3,0,0,7,0,0,0,0,6,0,0,1,9,5,0,0,0,0,9,8,0,0,0,0,6,0,8,0,0,0,6,0,0,0,3,4,0,0,8,0,3,0,0,1,7,0,0,0,2,0,0,0,6,0,6,0,0,0,0,2,8,0,0,0,0,4,1,9,0,0,5,0,0,0,0,8,0,0,7,9];
    return (
        <div className="widget p-6">
            <h3 className="text-[10px] font-black uppercase text-gray-400 mb-6 text-center">Sudoku</h3>
            <div className="sudoku-container">
                {grid.map((n, i) => (
                    <div key={i} className={`sudoku-cell ${n!==0?'fixed':''} ${i%3===2 && i%9!==8 ? 'border-r-thick' : ''} ${Math.floor(i/9)%3===2 && Math.floor(i/9)!==8 ? 'border-b-thick' : ''}`}>
                        {n !== 0 ? n : ''}
                    </div>
                ))}
            </div>
        </div>
    );
}

function SportWidget({ type }) {
    const [tab, setTab] = useState('last');
    return (
        <div className="widget h-[350px]">
            <div className="p-4 border-b bg-gray-50 text-[10px] font-black uppercase text-gray-500">{type} Pro Tour</div>
            <div className="flex border-b">
                <button onClick={()=>setTab('cal')} className={`tab-btn ${tab==='cal'?'active':''}`}>Kalender</button>
                <button onClick={()=>setTab('last')} className={`tab-btn ${tab==='last'?'active':''}`}>Laatste</button>
                <button onClick={()=>setTab('std')} className={`tab-btn ${tab==='std'?'active':''}`}>Stand</button>
            </div>
            <div className="p-6 flex-1 flex items-center justify-center text-xs italic text-gray-400">Syncing...</div>
        </div>
    );
}

// --- MAIN APP ---
function App() {
    const [isAuth, setIsAuth] = useState(S.load('auth', false));
    const [settOpen, setSettOpen] = useState(false);
    const [bv, setBv] = useState(S.load('bitvavo', {key:'', sec:''}));
    const [icals, setIcals] = useState(S.load('icals', [{name:'Ryan', url:''}, {name:'Yaron', url:''}]));
    const [aiKey, setAiKey] = useState(S.load('aikey', ''));

    const h = new Date().getHours();
    const greeting = h < 12 ? "Goedemorgen" : h < 18 ? "Goedemiddag" : "Goedenavond";

    if (!isAuth) {
        return (
            <div className="min-h-screen flex items-center justify-center bg-[#000a14]">
                <div className="bg-white/5 p-12 rounded-3xl border border-white/10 text-center backdrop-blur-xl">
                    <Ico.Lock /><h1 className="text-white font-black text-xl uppercase mt-6 mb-8 tracking-widest">Michael Dashboard</h1>
                    <button onClick={()=>{setIsAuth(true); S.save('auth', true);}} className="bg-white px-10 py-4 rounded-full font-black text-xs uppercase tracking-widest">Inloggen</button>
                </div>
            </div>
        );
    }

    return (
        <div className="flex flex-col min-h-screen pb-20">
            <WeatherBar />
            <header className="px-10 py-12 max-w-[1600px] mx-auto w-full flex justify-between items-end">
                <div><h1 className="text-4xl font-black text-white tracking-tighter uppercase">{greeting}, Michael</h1><p className="text-blue-400 text-[10px] font-black uppercase tracking-[0.5em] mt-3">Strategic HQ Dashboard v5.0</p></div>
                <button onClick={()=>setSettOpen(true)} className="p-4 bg-white/10 text-white rounded-2xl hover:bg-white/20 transition"><Ico.Set/></button>
            </header>

            <main className="px-10 max-w-[1600px] mx-auto w-full grid grid-cols-12 gap-8">
                <div className="col-span-12 lg:col-span-8"><AgendaWidget /></div>
                <div className="col-span-12 lg:col-span-4"><CryptoWidget /></div>
                
                <div className="col-span-12 lg:col-span-8 widget p-6 h-[400px]">
                    <h3 className="text-[10px] font-black uppercase text-gray-400 mb-6 tracking-widest">Nieuws (News)</h3>
                    <div className="scroll-v space-y-4">
                        {[1,2,3].map(i => (
                            <div key={i} className="border-b pb-4">
                                <p className="text-sm font-bold leading-relaxed">EU Strategie: Novo Nordisk breidt Europese productie verder uit voor 2026.</p>
                                <div className="flex justify-between mt-2 text-[9px] font-black uppercase tracking-widest">
                                    <span className="text-blue-800 font-bold italic underline">Financieel Dagblad</span><span className="text-gray-400 italic">2 uur geleden</span>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>

                <div className="col-span-12 lg:col-span-4"><SudokuWidget /></div>
                <div className="col-span-12 lg:col-span-4"><RecipeWidget /></div>
                <div className="col-span-12 lg:col-span-4"><PepperWidget /></div>
                
                <div className="col-span-12 lg:col-span-4 widget p-6 h-[400px]">
                    <h3 className="text-[10px] font-black uppercase text-gray-400 mb-6 tracking-widest">Investeringen</h3>
                    <div className="scroll-v space-y-3">
                        {[ {t:"ASML", p:"DEGIRO (NL)"}, {t:"Novo Nordisk", p:"Interactive Brokers"}, {t:"ETF S&P 500", p:"Trade Republic (EU)"} ].map((inv, i) => (
                            <div key={i} className="flex justify-between items-center p-4 border rounded-2xl bg-gray-50">
                                <span className="font-bold text-sm">{inv.t}</span><span className="text-[9px] bg-blue-900 text-white px-3 py-1 rounded-full font-black uppercase tracking-tighter">{inv.p}</span>
                            </div>
                        ))}
                    </div>
                </div>

                <div className="col-span-12 lg:col-span-6"><SportWidget type="F1" /></div>
                <div className="col-span-12 lg:col-span-6"><SportWidget type="GOLF" /></div>
            </main>

            <div className={`settings-panel ${settOpen ? 'open' : ''}`}>
                <div className="flex justify-between items-center mb-10 border-b pb-4"><h2 className="text-2xl font-black uppercase tracking-tighter">Configuratie</h2><button onClick={()=>setSettOpen(false)} className="text-4xl text-gray-300">√ó</button></div>
                <div className="space-y-8">
                    <section>
                        <label className="text-[10px] font-black text-blue-600 uppercase block mb-3 tracking-widest">Bitvavo API (Nederland)</label>
                        <input type="text" placeholder="API Key" value={bv.key} onChange={e=>{const n={...bv,key:e.target.value};setBv(n);S.save('bitvavo',n)}} className="w-full p-3 border rounded-xl bg-gray-50 text-xs font-mono mb-2" />
                        <input type="password" placeholder="API Secret" value={bv.sec} onChange={e=>{const n={...bv,sec:e.target.value};setBv(n);S.save('bitvavo',n)}} className="w-full p-3 border rounded-xl bg-gray-50 text-xs font-mono" />
                    </section>
                    <section>
                        <label className="text-[10px] font-black text-blue-600 uppercase block mb-3 tracking-widest">iCal Agendas (.ics)</label>
                        {icals.map((c,i) => (
                            <div key={i} className="flex gap-2 mb-2">
                                <input placeholder="Naam" value={c.name} className="w-1/4 p-3 border rounded-xl text-xs font-bold" readOnly />
                                <input placeholder="https://..." value={c.url} onChange={e=>{const n=[...icals];n[i].url=e.target.value;setIcals(n);S.save('icals',n)}} className="flex-1 p-3 border rounded-xl text-xs font-mono" />
                            </div>
                        ))}
                    </section>
                    <section>
                        <label className="text-[10px] font-black text-blue-600 uppercase block mb-3 tracking-widest">OpenAI / AI Assistent</label>
                        <input type="password" placeholder="sk-..." value={aiKey} onChange={e=>{setAiKey(e.target.value);S.save('aikey',e.target.value)}} className="w-full p-3 border rounded-xl bg-gray-50 text-xs font-mono" />
                    </section>
                    <button onClick={()=>{S.remove('auth'); window.location.reload();}} className="w-full py-4 bg-red-50 text-red-600 rounded-xl font-black uppercase text-[10px] tracking-widest">Uitloggen uit Dashboard</button>
                </div>
            </div>
        </div>
    );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>